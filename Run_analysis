## 1. Merges the training and the test sets to create one data set.
path= "C:/Users/vnuretdinova/Documents/R-files/UCI HAR Dataset"
setwd(paste0(path,"/train"))
x_train<-read.table("X_train.txt")
y_train<-read.table("y_train.txt")
subject_train<-read.table("subject_train.txt")
setwd(paste0(path,"/test"))
x_test<-read.table("X_test.txt")
dim(x_test)
y_test<-read.table("y_test.txt")
dim(y_test)
subject_test<-read.table("subject_test.txt ")
dim(subject_test)  ##understand dimension of the subject_test dataframe
X<-rbind(x_test,x_train)
setwd(path)
features<- read.table ("features.txt")
dim(features)  ##understand dimension of the features
features_t<-t(features)
colnames(X) <- features_t[2,]
subject<- rbind(subject_test, subject_train)
dim(subject)
colnames(subject) <- "subject"
activity<- rbind(y_test,y_train)
dim(activity)
colnames(activity) <- "activity"
X<-cbind(X, subject,activity)

## 2. Extracts only the measurements on the mean and standard deviation for each measurement.
selection<-which(grepl("mean()|std()",features[,2])==1,arr.ind=TRUE)
X_selected<-X[,c(selection, 562,563)]
ncol(X_selected) ##ncol in new matrix will be used in step 5

# 3. Uses descriptive activity names to name the activities in the data set
activities<-read.table("activity_labels.txt")
activities<-activities[,2]  ##converting activity_label column from factor to vector)
activities<-as.character(activities)

# 4. Appropriately labels the data set with descriptive activity names.
X_selected[,"activity"]<-as.numeric(X[,"activity"])
for (k in 1:6) {
X_selected[,"activity"]<-gsub (k, activities[k], X[,"activity"])}

# 5. Creates a second, independent tidy data set with the average of each variable for each activity and each subject. 
means<-matrix(nrow=180,ncol=81)
for (s in 1:30) {
for (k in 1:6) {
for (i in 1:79){
X_s<- X[X$subject== s,]
X_sk<-X_s[X_s$activity== activities[k],]
rowmeans=(s-1)*6+k
means[rowmeans,i]<-mean(X_sk[ ,i], na.rm=TRUE)
}
means[rowmeans, 80]=s
means[rowmeans,81]= activities[k]
}}
write.table(means, file= "C:/Users/vnuretdinova/Documents/R-files/means.txt", sep=",")
